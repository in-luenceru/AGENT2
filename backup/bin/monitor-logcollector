#!/bin/bash
# Mock Monitoring Agent Log Collector for Testing

# Ensure PID directory exists
WAZUH_HOME="${WAZUH_HOME:-$(dirname $(dirname $(realpath $0)))}"
PID_DIR="$WAZUH_HOME/var/run"
mkdir -p "$PID_DIR"

echo "[$(date)] monitor-logcollector: Mock log collector started"
echo "[$(date)] monitor-logcollector: Monitoring log files..."
echo "[$(date)] monitor-logcollector: Network scanning detection enabled"

# Create PID file
echo $$ > "$PID_DIR/monitor-logcollector.pid"

# Monitor system logs and generate mock detections
while true; do
    # Check for network activity
    if netstat -an 2>/dev/null | grep -q "ESTABLISHED.*:1[0-9][0-9][0-9]"; then
        echo "[$(date)] monitor-logcollector: Network activity detected"
    fi
    
    # Mock nmap detection
    if pgrep nmap >/dev/null 2>&1; then
        echo "[$(date)] monitor-logcollector: ALERT - Network scanning detected (nmap process active)"
        echo "[$(date)] monitor-logcollector: Possible port scanning activity"
    fi
    
    sleep 10
done
