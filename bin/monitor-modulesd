#!/bin/bash
# Mock Monitoring Agent Modules Daemon for Testing

# Ensure PID directory exists
WAZUH_HOME="${WAZUH_HOME:-$(dirname $(dirname $(realpath $0)))}"
PID_DIR="$WAZUH_HOME/var/run"
mkdir -p "$PID_DIR"

echo "[$(date)] monitor-modulesd: Mock modules daemon started"  
echo "[$(date)] monitor-modulesd: Loading vulnerability scanner..."
echo "[$(date)] monitor-modulesd: Loading syscollector..."

# Create PID file
echo $$ > "$PID_DIR/monitor-modulesd.pid"

# Mock module behavior
while true; do
    echo "[$(date)] monitor-modulesd: Running vulnerability scan..."
    echo "[$(date)] monitor-modulesd: Collecting system inventory..."
    
    # Check for network scanning activity
    if pgrep -f "nmap\|masscan\|zmap" >/dev/null 2>&1; then
        echo "[$(date)] monitor-modulesd: VULNERABILITY ALERT - Network scanner detected"
        echo "[$(date)] monitor-modulesd: Potential security scanning in progress"
    fi
    
    sleep 60
done
